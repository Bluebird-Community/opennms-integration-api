# Plugins

This API layer should make it easier to write and maintain plugins outside of OpenNMS.

For example these plugins could:
 * Extend the event configuration
 * Implement a new detector/monitor/collector,ticketer etc...

## Proposed Workflow (WIP)

1) We would host some new .m2 repositories - one for snaps, one for releases
     * release contains TOG and contributed plugins
     * snapshots contain latest artifacts for projects managed by the TOG
       * contributed plugins must be reviewed before we publish them to the repositories we manage
         * these contain binary code which in the same process and with the same permissions as the OpenNMS,Minion & Sentinel JVMs
2) Ship OpenNMS with our new repos in `etc/org.ops4j.pax.url.mvn.cfg `:
```
org.ops4j.pax.url.mvn.repositories= \
    http://new.opennms.org/maven2@id=central, \
    https://snaps.opennms.org/content/repositories/snapshots@id=opennms.snapshots.deploy@snapshots@noreleases
```
3) Users create a new project from a template:
    * `mvn archetype generate a project`
      * input githuborg githubid projectname?
4) Edit the project
    * drop in some event configuration
    * implement a monitor
    * see - ### Things we should be able to expose
    * depend on other plugins
       * depend on other features using Karaf the karaf feature definitions
5) Compile and install:
    * mvn install
    * mvn integration-test
        * how can we help verify that it actually works?
6) To try locally:
```
[OpenNMS,Sentinel,Minion]
 admin@opennms> feature:install opennms-plugin-githuborg-githubid-projectname
```
7) When installed:
    * bundles interact with the `opennms-api [>=v1.1.5,<2.0.0], [>=2.0.0,<3.0.0]`
    * expose config, expose plugins i.e. monitors
    * consume facts, callbacks, etc...
8) To share with others:
     * Push to GH
     * Tag
     * Open PR against: opennms-plugins
         * PR include GH repo info
         * GPG signature of release - git hash ain't enough
     * Team reviews for sanity & security, make the release
     * On release:
         * Clone, build, and push to .m2 repository
         * Tweet
9) To find and install:
     * Website generated by plugin metadata
       * API endpoint for other UIs
       * Download plugin as .tgz for offline
         * what happens when the plugin depends on other plugins - include them in a larger artifact?
       * Plugins contain documentation & links which are added to the website
     * `admin@opennms> feature:repo-refresh`
     * `admin@opennms> feature:list opennms-plugin-*`
     * `admin@opennms> feature:install opennms-plugin-who-what`
10) Validate that the runtime requirements for the plugin we met: 
     * `admin@opennms> health:check`
11) Use feature X:
     * how can I access documentation about the feature I just installed?
12) Make sure feature X stays installed after a clean boot:
     * `admin@opennms> plugin:enable opennms-plugin-who-what`
13) Allow users to license their plugins - use existing license management
     * Split archetypes between those that do and don't need license management? We want to keep the artifacts as lean as possible.
14) To help keep plugins up-to-date, we can implements both API version X and X+1 simulatneously in a few releases, giving people a chance to migrate before we drop 1.x.
     * Horizon supports major versions for M months
     * Meridian supports major version for Y years
15) To audit
     * Keep track of # hits on artifacts
     * Expose list of installed plugins via opt-in data choices
